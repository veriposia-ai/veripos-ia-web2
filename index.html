<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VeriPOS IA â€” DEMO limpia</title>
  <style>
    :root{--bg:#000;--card:#0f1115;--line:#1f2532;--fg:#fff;--muted:#98a2b3;--blue:#0078A8}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid var(--line)}
    .logo{font-weight:700} .wrap{padding:16px}
    .panel{max-width:420px;margin:32px auto;background:var(--card);border:1px solid var(--line);border-radius:14px;padding:18px}
    input,button{width:100%;border-radius:10px;border:1px solid var(--line);padding:12px;background:#0a0d13;color:#fff}
    button{background:var(--blue);border:none;cursor:pointer} button.secondary{background:#2a2f3a}
    .muted{color:var(--muted)} .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px;text-align:left;cursor:pointer}
    .pos{display:flex;gap:14px} .left{flex:1} .right{width:360px}
    .ticket{position:sticky;top:16px;background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px}
    .row{display:flex;justify-content:space-between;margin:.35rem 0} .total{font-weight:700;font-size:1.1rem}
    @media print{
      header,.controls,.no-print{display:none!important}
      body{background:#fff;color:#000}
      .ticket{border:none}
    }
  </style>
  <!-- QR por CDN (no instala nada) -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>
  <header>
    <div class="logo">VeriPOS IA</div>
    <div class="muted">DEMO limpia (sin cachÃ© ni SW)</div>
  </header>

  <!-- Vista: pedir nombre (inicio de turno) -->
  <section id="view-turno" class="wrap">
    <div class="panel">
      <h2>ðŸ‘‹ Bienvenido, equipo VeriPOS IA</h2>
      <p class="muted">Escribe tu nombre para que salga en el ticket.</p>
      <input id="nombre" placeholder="Ej. Laura" />
      <button id="btnTurno" class="no-print" style="margin-top:10px">Comenzar turno</button>
    </div>
  </section>

  <!-- Vista: TPV -->
  <section id="view-pos" class="wrap" style="display:none">
    <div class="controls no-print" style="margin-bottom:10px;display:flex;gap:8px;align-items:center">
      <span class="muted">IGIC 7 %</span>
      <input id="buscar" placeholder="Buscar productoâ€¦" style="max-width:280px" />
    </div>
    <div class="pos">
      <div class="left">
        <div id="grid" class="grid"></div>
      </div>
      <div class="right">
        <div class="ticket" id="ticket">
          <h3 style="margin:6px 0">VeriPOS IA</h3>
          <div class="muted" id="camareroTxt">Atendido por: â€”</div>
          <hr style="border-color:#222">
          <div id="lineas"></div>
          <hr style="border-color:#222">
          <div class="row"><span>Subtotal</span><span id="subtotal">0,00 â‚¬</span></div>
          <div class="row"><span>IGIC (7%)</span><span id="igic">0,00 â‚¬</span></div>
          <div class="row total"><span>Total</span><span id="total">0,00 â‚¬</span></div>
          <button id="btnCobrar" class="no-print" style="margin-top:10px">Cobrar / Emitir ticket Veri*Factu</button>
          <button id="btnImprimir" class="secondary no-print" style="margin-top:8px;display:none">Imprimir ticket</button>
          <div id="qrBox" class="no-print" style="margin-top:10px"></div>
        </div>
      </div>
    </div>
  </section>

  <script>
    // ===== Estado =====
    const IGIC = 0.07;
    const productosBase = [
      {id:"1", name:"Smash Burger", price:9.90},
      {id:"2", name:"Cheeseburger", price:8.90},
      {id:"3", name:"Papas fritas", price:3.50},
      {id:"4", name:"Refresco lata", price:2.00},
      {id:"5", name:"Agua", price:1.50}
    ];
    const V = { camarero:null, carrito:[], productos:[...productosBase] };

    // ===== Utiles =====
    const â‚¬ = n => (Number(n).toFixed(2).replace(".",","))+" â‚¬";
    const el = id => document.getElementById(id);

    // ===== Inicio de turno =====
    el("btnTurno").onclick = () => {
      const n = el("nombre").value.trim();
      if(!n){ alert("Escribe tu nombre"); return; }
      V.camarero = n;
      el("camareroTxt").textContent = "Atendido por: " + n;
      document.getElementById("view-turno").style.display="none";
      document.getElementById("view-pos").style.display="block";
      pintarProductos();
    };

    // ===== Productos / bÃºsqueda =====
    el("buscar").addEventListener("input", pintarProductos);
    function pintarProductos(){
      const q = (el("buscar").value||"").toLowerCase();
      const cont = el("grid"); cont.innerHTML="";
      V.productos
        .filter(p => p.name.toLowerCase().includes(q))
        .forEach(p=>{
          const b = document.createElement("button");
          b.className="card";
          b.innerHTML = `<b>${p.name}</b><div class="muted">${â‚¬(p.price)}</div>`;
          b.onclick = ()=>{ V.carrito.push(p); renderTicket(); };
          cont.appendChild(b);
        });
    }

    // ===== Ticket =====
    function renderTicket(){
      const cont = el("lineas"); cont.innerHTML="";
      let subtotal=0;
      V.carrito.forEach((p,i)=>{
        subtotal += p.price;
        const row = document.createElement("div");
        row.className="row";
        row.innerHTML=`<span>${p.name}</span><span>${â‚¬(p.price)}</span>`;
        cont.appendChild(row);
      });
      const igic = subtotal*IGIC;
      const total = subtotal+igic;
      el("subtotal").textContent = â‚¬(subtotal);
      el("igic").textContent = â‚¬(igic);
      el("total").textContent = â‚¬(total);
    }

    // ===== Cobrar / QR simulado / Imprimir =====
    el("btnCobrar").onclick = async ()=>{
      if(!V.carrito.length){ alert("AÃ±ade productos al ticket"); return; }
      const payload = {
        fecha: new Date().toLocaleString(),
        camarero: V.camarero,
        total: el("total").textContent
      };
      el("qrBox").innerHTML="";
      await QRCode.toCanvas(JSON.stringify(payload), {width:160}, (err,canvas)=>{
        if(err){ alert("No se pudo generar el QR"); return; }
        el("qrBox").appendChild(canvas);
      });
      el("btnImprimir").style.display="block";
      alert("Ticket listo. QR Veri*Factu (simulado) generado.");
    };

    el("btnImprimir").onclick = ()=> window.print();

    // Arranque seguro sin cachÃ© previa
    console.log("âœ… VeriPOS IA DEMO limpia cargada");
  </script>
</body>
</html>
